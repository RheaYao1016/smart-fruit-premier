import{u as T}from"./production-CQtRph0L.js";import{x as A,f as w,y as B,o as u,c,a as t,t as d,F as j,r as I,z as $,e as l,A as V,p as D,d as z,j as E,m as G,i as k,n as L,s as P,g as W,u as q,_ as H,B as J,C as K,q as Q}from"./index-DkfAZXiR.js";import{_ as X}from"./ImageField-Dax1EdUO.js";import"./ImageEditor-DJcDNQea.js";/**
 * @license lucide-vue-next v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=A("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Z={class:"space-y-4"},tt={class:"card p-4"},et={class:"mt-4 flex items-center justify-center gap-4"},st={class:"rounded-2xl bg-amber-50 px-5 py-2 text-2xl font-bold text-amber-600"},nt={class:"grid grid-cols-3 gap-2"},ot=["src"],rt={__name:"Step1Placement",emits:["next"],setup(S,{emit:x}){const f=x,n=T(),s=w(n.draft.fruitCount);B(s,v=>{const i=Math.max(1,Math.min(6,Number(v||1)));i!==v&&(s.value=i)});function a(){s.value=Math.max(1,s.value-1)}function r(){s.value=Math.min(6,s.value+1)}function o(){n.setFruitCount(s.value),f("next")}return(v,i)=>(u(),c("div",Z,[t("div",tt,[i[0]||(i[0]=t("h2",{class:"text-lg font-semibold"},"步骤1：水果安放",-1)),i[1]||(i[1]=t("p",{class:"mt-1 text-sm text-stone-500"},"请先放置水果，再确认数量（1-6个）。",-1)),t("div",et,[t("button",{class:"h-10 w-10 rounded-full bg-stone-100 text-xl",onClick:a},"-"),t("div",st,d(s.value),1),t("button",{class:"h-10 w-10 rounded-full bg-stone-100 text-xl",onClick:r},"+")])]),t("div",nt,[(u(),c(j,null,I(6,g=>t("div",{key:g,class:$(["overflow-hidden rounded-xl border",g<=s.value?"border-amber-300 bg-amber-50":"border-stone-200 bg-stone-100 opacity-50"])},[t("img",{src:l(V).fruits[(g-1)%l(V).fruits.length],class:"h-20 w-full object-cover"},null,8,ot)],2)),64))]),t("button",{class:"w-full rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:o},"继续：水果预处理")]))}},at={class:"space-y-4"},lt={class:"space-y-3"},dt={class:"mb-3 text-sm font-medium"},it={class:"grid grid-cols-3 gap-2 text-sm"},ut=["onClick"],ct=["onClick"],pt={class:"grid grid-cols-2 gap-2"},xt={__name:"Step2Preprocess",emits:["next","back"],setup(S,{emit:x}){const f=x,n=T();function s(a,r){const o=n.draft.fruits[a];!o||r==="cutting"||n.updateFruit(a,{[r]:!o[r]})}return(a,r)=>(u(),c("div",at,[r[3]||(r[3]=t("div",{class:"card p-4"},[t("h2",{class:"text-lg font-semibold"},"步骤2：水果预处理"),t("p",{class:"mt-1 text-sm text-stone-500"},"去核/削皮可选；切块必选且不可取消。")],-1)),t("div",lt,[(u(!0),c(j,null,I(l(n).draft.fruits,(o,v)=>(u(),c("div",{key:o.id,class:"card p-4"},[t("p",dt,"水果 "+d(o.id),1),t("div",it,[t("button",{class:$(["rounded-xl border px-2 py-2",o.pitting?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:i=>s(v,"pitting")}," 去核 "+d(o.pitting?"✓":""),11,ut),t("button",{class:$(["rounded-xl border px-2 py-2",o.peeling?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:i=>s(v,"peeling")}," 削皮 "+d(o.peeling?"✓":""),11,ct),r[2]||(r[2]=t("div",{class:"rounded-xl border border-emerald-300 bg-emerald-50 px-2 py-2 text-center text-emerald-700"}," 切块 ✓ ",-1))])]))),128))]),t("div",pt,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:r[0]||(r[0]=o=>f("back"))},"上一步"),t("button",{class:"rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:r[1]||(r[1]=o=>f("next"))},"继续：处理方案")])]))}},mt={class:"space-y-4"},vt={key:0,class:"grid grid-cols-1 gap-3"},bt={key:1,class:"card space-y-3 p-4"},ft={class:"font-medium"},gt={class:"rounded-xl border border-stone-200 bg-stone-50 p-3"},_t={class:"overflow-hidden rounded-xl bg-stone-900"},yt={key:1,class:"flex h-44 w-full items-center justify-center px-4 text-center text-sm text-stone-300"},wt={key:0,class:"mt-2 text-xs text-rose-500"},kt={class:"rounded-xl border border-amber-200 bg-amber-50/50 p-2"},$t={class:"mb-2 inline-flex items-center gap-2 text-sm font-medium text-amber-700"},ht=["src"],Ct={class:"grid grid-cols-2 gap-2"},St={key:2,class:"space-y-3"},Mt={key:0,class:"card space-y-3 p-4"},Tt={class:"grid grid-cols-3 gap-2"},jt=["onClick"],It=["value"],Vt={class:"mt-1 text-xs text-stone-600"},Nt={class:"grid grid-cols-2 gap-2"},Bt=["value"],Dt={class:"mt-1 text-xs text-stone-600"},zt={key:1,class:"card space-y-3 p-4"},Et=["value"],Pt={class:"mt-1 text-xs text-stone-600"},Rt=["value"],Ut={class:"mt-1 text-xs text-stone-600"},Ft={class:"grid grid-cols-2 gap-2"},Ot={__name:"Step3Scheme",emits:["next","back"],setup(S,{emit:x}){const f=x,n=T(),s=w(n.draft.mode?"blade":"mode"),a=w(n.draft.mode||"juice"),r=w(!1),o=w("idle"),v=w(""),i=w(null);let g=null;const h=k(()=>a.value==="juice"?"果汁":a.value==="canned"?"罐头":"果切"),p=k(()=>{var e;const y=(e=V.bladeGuides)==null?void 0:e[a.value];return(y==null?void 0:y.url)||"/刀片图1.png"}),b=k(()=>r.value?V.bladeImages[a.value]:p.value),_=["冷饮","常温","热饮"],M=["细腻无渣","微渣口感","高纤维"];function N(y){a.value=y,s.value="blade",r.value=!1,C()}function R(){if(C(),n.setMode(a.value),a.value==="cut"){f("next");return}s.value="settings"}function U(){f("next")}function F(){r.value=!0}async function O(){var y;if(v.value="",o.value="loading",!((y=navigator.mediaDevices)!=null&&y.getUserMedia)){o.value="error",v.value="当前浏览器不支持摄像头访问。";return}try{C(),g=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}},audio:!1}),i.value&&(i.value.srcObject=g,await i.value.play()),o.value="active"}catch{o.value="error",v.value="摄像头打开失败，请确认权限已允许。"}}function C(){g&&(g.getTracks().forEach(y=>y.stop()),g=null),i.value&&(i.value.srcObject=null),o.value==="active"&&(o.value="idle")}return B(s,y=>{y!=="blade"&&C()}),D(()=>{C()}),(y,e)=>(u(),c("div",mt,[e[26]||(e[26]=t("div",{class:"card p-4"},[t("h2",{class:"text-lg font-semibold"},"步骤3：处理方案选择"),t("p",{class:"mt-1 text-sm text-stone-500"},"果汁 / 罐头 / 果切")],-1)),s.value==="mode"?(u(),c("section",vt,[t("button",{class:"card p-4 text-left",onClick:e[0]||(e[0]=m=>N("juice"))},[...e[12]||(e[12]=[t("p",{class:"text-base font-semibold"},"果汁",-1),t("p",{class:"text-xs text-stone-500"},"支持滤网口感、温度、甜度配置",-1)])]),t("button",{class:"card p-4 text-left",onClick:e[1]||(e[1]=m=>N("canned"))},[...e[13]||(e[13]=[t("p",{class:"text-base font-semibold"},"罐头",-1),t("p",{class:"text-xs text-stone-500"},"支持温度和甜度配置",-1)])]),t("button",{class:"card p-4 text-left",onClick:e[2]||(e[2]=m=>N("cut"))},[...e[14]||(e[14]=[t("p",{class:"text-base font-semibold"},"果切",-1),t("p",{class:"text-xs text-stone-500"},"完成刀头检查后可直接制作",-1)])])])):s.value==="blade"?(u(),c("section",bt,[t("p",ft,"刀头检查（"+d(h.value)+"）",1),t("div",gt,[e[15]||(e[15]=t("p",{class:"mb-2 text-sm text-stone-600"},"点击下方按钮打开摄像头，实时查看刀片安装状态。",-1)),t("div",_t,[o.value==="active"?(u(),c("video",{key:0,ref_key:"videoRef",ref:i,autoplay:"",muted:"",playsinline:"",class:"h-44 w-full object-cover"},null,512)):(u(),c("div",yt,d(o.value==="loading"?"正在打开摄像头...":"未开启摄像头，点击按钮开始检查。"),1))]),v.value?(u(),c("p",wt,d(v.value),1)):z("",!0),t("div",{class:"mt-2 grid grid-cols-2 gap-2"},[t("button",{class:"rounded-xl border border-stone-300 px-3 py-2 text-sm",onClick:O},"打开摄像头"),t("button",{class:"rounded-xl border border-stone-300 px-3 py-2 text-sm",onClick:C},"关闭摄像头")])]),t("div",kt,[t("div",$t,[E(l(Y),{class:"h-4 w-4"}),e[16]||(e[16]=G(" 刀片示意图 ",-1))]),t("img",{src:b.value,class:"h-32 w-full rounded-lg object-cover",onError:F},null,40,ht),e[17]||(e[17]=t("div",{class:"mt-2 rounded-lg bg-white/80 px-3 py-2 text-xs leading-5 text-stone-600"},[t("p",null,"1. 确认刀片卡槽方向与示意图一致。"),t("p",null,"2. 刀片边缘无裂痕、无明显磨损。"),t("p",null,"3. 旋紧锁扣后再继续下一步。")],-1))]),t("div",Ct,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-2",onClick:e[3]||(e[3]=m=>s.value="mode")},"重新选方案"),t("button",{class:"rounded-xl bg-amber-500 px-4 py-2 font-semibold text-white",onClick:R},"已检查完成")])])):(u(),c("section",St,[a.value==="juice"?(u(),c("div",Mt,[e[22]||(e[22]=t("p",{class:"font-medium"},"果汁参数",-1)),t("div",null,[e[18]||(e[18]=t("p",{class:"mb-2 text-xs text-stone-500"},"滤网口感",-1)),t("div",Tt,[(u(),c(j,null,I(M,m=>t("button",{key:m,class:$(["rounded-xl border px-2 py-2 text-xs",l(n).draft.settings.texture===m?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:fe=>l(n).updateSettings({texture:m})},d(m),11,jt)),64))])]),t("div",null,[e[19]||(e[19]=t("p",{class:"mb-2 text-xs text-stone-500"},"温度",-1)),t("input",{type:"range",min:"0",max:"2",step:"1",value:_.indexOf(l(n).draft.settings.temperature),class:"w-full accent-amber-500",onInput:e[4]||(e[4]=m=>l(n).updateSettings({temperature:_[Number(m.target.value)]}))},null,40,It),t("p",Vt,"当前："+d(l(n).draft.settings.temperature),1)]),t("div",null,[e[20]||(e[20]=t("p",{class:"mb-2 text-xs text-stone-500"},"甜度",-1)),t("div",Nt,[t("button",{class:$(["rounded-xl border px-2 py-2 text-xs",l(n).draft.settings.sweetnessType==="自定义"?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:e[5]||(e[5]=m=>l(n).updateSettings({sweetnessType:"自定义"}))},"自定义",2),t("button",{class:$(["rounded-xl border px-2 py-2 text-xs",l(n).draft.settings.sweetnessType==="健康推荐"?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:e[6]||(e[6]=m=>l(n).updateSettings({sweetnessType:"健康推荐",sweetnessValue:20}))},"健康推荐",2)]),t("input",{type:"range",min:"0",max:"100",step:"1",class:"mt-2 w-full accent-amber-500",value:l(n).draft.settings.sweetnessValue,onInput:e[7]||(e[7]=m=>l(n).updateSettings({sweetnessValue:Number(m.target.value)}))},null,40,Bt),t("p",Dt,"甜度："+d(l(n).draft.settings.sweetnessValue)+"%",1),e[21]||(e[21]=t("p",{class:"text-xs text-emerald-600"},"建议：低糖用户可控制在 0~30%。",-1))])])):(u(),c("div",zt,[e[25]||(e[25]=t("p",{class:"font-medium"},"罐头参数",-1)),t("div",null,[e[23]||(e[23]=t("p",{class:"mb-2 text-xs text-stone-500"},"温度",-1)),t("input",{type:"range",min:"0",max:"2",step:"1",value:_.indexOf(l(n).draft.settings.cannedTemperature),class:"w-full accent-amber-500",onInput:e[8]||(e[8]=m=>l(n).updateSettings({cannedTemperature:_[Number(m.target.value)]}))},null,40,Et),t("p",Pt,"当前："+d(l(n).draft.settings.cannedTemperature),1)]),t("div",null,[e[24]||(e[24]=t("p",{class:"mb-2 text-xs text-stone-500"},"甜度",-1)),t("input",{type:"range",min:"0",max:"100",step:"1",value:l(n).draft.settings.cannedSweetness,class:"w-full accent-amber-500",onInput:e[9]||(e[9]=m=>l(n).updateSettings({cannedSweetness:Number(m.target.value)}))},null,40,Rt),t("p",Ut,"当前："+d(l(n).draft.settings.cannedSweetness)+"%",1)])])),t("div",Ft,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:e[10]||(e[10]=m=>s.value="blade")},"返回刀头检查"),t("button",{class:"rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:U},"继续：制作监控")])])),t("button",{class:"w-full rounded-xl border border-stone-300 px-4 py-2",onClick:e[11]||(e[11]=m=>f("back"))},"返回上一步")]))}},At={class:"space-y-4"},Gt={class:"card p-4"},Lt={class:"mb-2 flex items-center justify-between text-sm"},Wt={class:"font-semibold text-amber-600"},qt={class:"h-3 overflow-hidden rounded-full bg-stone-100"},Ht={class:"mt-2 text-xs text-stone-500"},Jt={class:"card p-4"},Kt={class:"grid grid-cols-3 gap-2 text-sm"},Qt={class:"grid grid-cols-2 gap-2"},Xt=["disabled"],Yt={__name:"Step4Monitor",emits:["next","back"],setup(S,{emit:x}){const f=x,n=T(),s=w(0),a=w(!1),r=w([]);let o=null;const v=k(()=>Math.max(8e3,n.draft.fruitCount*3500)),i=k(()=>Math.max(0,Math.round(v.value*(1-s.value/100)/1e3)));function g(){const p=100/(v.value/200);o=window.setInterval(()=>{s.value=Math.min(100,s.value+p);const b=Math.floor(s.value/100*n.draft.fruitCount);r.value=Array.from({length:b},(_,M)=>M+1),s.value>=100&&(a.value=!0,window.clearInterval(o),o=null)},200)}return L(()=>{g()}),D(()=>{o&&window.clearInterval(o)}),(h,p)=>(u(),c("div",At,[p[4]||(p[4]=t("div",{class:"card p-4"},[t("h2",{class:"text-lg font-semibold"},"步骤4：制作与监控"),t("p",{class:"mt-1 text-sm text-stone-500"},"正在按设定参数处理水果。")],-1)),t("div",Gt,[t("div",Lt,[p[2]||(p[2]=t("span",null,"当前进度",-1)),t("span",Wt,d(Math.round(s.value))+"%",1)]),t("div",qt,[t("div",{class:"h-full bg-amber-500 transition-all",style:P({width:`${s.value}%`})},null,4)]),t("p",Ht,"预计剩余 "+d(i.value)+" 秒",1)]),t("div",Jt,[p[3]||(p[3]=t("p",{class:"mb-2 text-sm font-medium"},"水果完成状态",-1)),t("div",Kt,[(u(!0),c(j,null,I(l(n).draft.fruitCount,b=>(u(),c("div",{key:b,class:$(["rounded-xl border px-2 py-2 text-center",r.value.includes(b)?"border-emerald-300 bg-emerald-50 text-emerald-700":"border-stone-200 text-stone-500"])},d(r.value.includes(b)?"已完成":"处理中")+" #"+d(b),3))),128))])]),t("div",Qt,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:p[0]||(p[0]=b=>f("back"))},"上一步"),t("button",{class:$(["rounded-xl px-4 py-3 font-semibold text-white",a.value?"bg-amber-500":"bg-stone-300"]),disabled:!a.value,onClick:p[1]||(p[1]=b=>f("next"))},d(a.value?"继续：完成提示":"制作中..."),11,Xt)])]))}},Zt={class:"space-y-4"},te={class:"card p-4"},ee={class:"mt-1 text-sm text-stone-500"},se={class:"card p-4"},ne={class:"whitespace-pre-wrap rounded-xl bg-stone-50 p-3 text-xs text-stone-600"},oe={class:"grid grid-cols-1 gap-2"},re={key:0,class:"rounded-xl bg-green-50 px-3 py-2 text-xs text-green-600"},ae={__name:"Step5Complete",emits:["restart"],setup(S,{emit:x}){const f=x,n=W(),s=T(),a=q(),r=w(!1),o=w(""),v=k(()=>s.draft.mode==="juice"?"果汁":s.draft.mode==="canned"?"罐头":s.draft.mode==="cut"?"果切":"-"),i=k(()=>s.draft.mode==="juice"?{texture:s.draft.settings.texture,temperature:s.draft.settings.temperature,sweetnessType:s.draft.settings.sweetnessType,sweetnessValue:s.draft.settings.sweetnessValue}:s.draft.mode==="canned"?{temperature:s.draft.settings.cannedTemperature,sweetnessValue:s.draft.settings.cannedSweetness}:{bladeChecked:!0});function g(){var b;(b=a.currentUser)!=null&&b.id&&(s.addHistoryRecord({userId:a.currentUser.id,mode:s.draft.mode,fruitCount:s.draft.fruitCount,preprocess:s.draft.fruits,params:i.value,image:o.value||""}),r.value=!0)}function h(){s.resetDraft(),o.value="",r.value=!1,f("restart")}function p(){s.resetDraft(),n.push("/my")}return(b,_)=>(u(),c("div",Zt,[t("div",te,[_[1]||(_[1]=t("h2",{class:"text-lg font-semibold text-emerald-700"},"步骤5：制作完成",-1)),t("p",ee,"本次模式："+d(v.value)+"，水果数量："+d(l(s).draft.fruitCount)+"。",1)]),t("div",se,[_[2]||(_[2]=t("p",{class:"mb-2 text-sm font-medium"},"参数回顾",-1)),t("pre",ne,d(JSON.stringify(i.value,null,2)),1)]),E(X,{modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=M=>o.value=M),label:"制作截图（可选）","aspect-hint":"自由比例"},null,8,["modelValue"]),t("div",oe,[t("button",{class:"rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:g},"保存到历史制作记录"),r.value?(u(),c("p",re,"已保存，可在“我的 -> 历史制作记录”查看。")):z("",!0),t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:h},"再做一单"),t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:p},"完成并去我的")])]))}},le={class:"space-y-4"},de={class:"card p-3"},ie={class:"grid grid-cols-5 gap-1 text-center text-[11px]"},ue={class:"card overflow-hidden"},ce={class:"wizard-tail-bg p-4"},pe={class:"mb-2 flex items-center justify-between"},xe={class:"rounded-full bg-white/70 px-2 py-0.5 text-[10px] text-stone-600"},me={class:"h-2 overflow-hidden rounded-full bg-white/70"},ve={class:"mt-3 rounded-xl bg-white/75 px-3 py-2 text-xs leading-5 text-stone-600"},be={__name:"ProductionWizard",setup(S){const x=w(1),f={1:rt,2:xt,3:Ot,4:Yt,5:ae},n=["水果安放","预处理","方案选择","制作监控","完成"],s=["请确保水果摆放稳定，避免加工时偏移。","切块为必选，去核和削皮可按水果类型选择。","先确认刀片状态，再设置温度/甜度等参数。","监控进度和预计时间，过程可实时查看。","完成后建议保存历史记录，便于复用方案。"],a=k(()=>f[x.value]),r=k(()=>s[x.value-1]||""),o=k(()=>Math.round(x.value/n.length*100));function v(){x.value<5&&(x.value+=1)}function i(){x.value>1&&(x.value-=1)}function g(){x.value=1}return(h,p)=>(u(),c("div",le,[t("div",de,[t("div",ie,[(u(),c(j,null,I(n,(b,_)=>t("div",{key:b,class:$(["rounded-xl px-1 py-2",_+1<=x.value?"bg-amber-500 text-white":"bg-stone-100 text-stone-500"])},d(_+1)+"."+d(b),3)),64))])]),(u(),J(K(a.value),{onNext:v,onBack:i,onRestart:g},null,32)),t("section",ue,[t("div",ce,[t("div",pe,[p[0]||(p[0]=t("h3",{class:"text-sm font-semibold text-stone-800"},"制作助手",-1)),t("span",xe,"阶段 "+d(x.value)+"/5",1)]),t("div",me,[t("div",{class:"h-full bg-gradient-to-r from-amber-500 to-emerald-400 transition-all duration-500",style:P({width:`${o.value}%`})},null,4)]),t("p",ve,d(r.value),1),p[1]||(p[1]=Q('<div class="mt-3 grid grid-cols-3 gap-2" data-v-c10c1041><div class="rounded-xl bg-white/75 px-2 py-2 text-center" data-v-c10c1041><p class="text-[10px] text-stone-500" data-v-c10c1041>刀片状态</p><p class="mt-1 text-xs font-semibold text-emerald-600 pulse-text" data-v-c10c1041>正常</p></div><div class="rounded-xl bg-white/75 px-2 py-2 text-center" data-v-c10c1041><p class="text-[10px] text-stone-500" data-v-c10c1041>温控</p><p class="mt-1 text-xs font-semibold text-amber-600 pulse-text" data-v-c10c1041>稳定</p></div><div class="rounded-xl bg-white/75 px-2 py-2 text-center" data-v-c10c1041><p class="text-[10px] text-stone-500" data-v-c10c1041>建议</p><p class="mt-1 text-xs font-semibold text-cyan-600 pulse-text" data-v-c10c1041>低糖优先</p></div></div>',1))])])]))}},ke=H(be,[["__scopeId","data-v-c10c1041"]]);export{ke as default};
