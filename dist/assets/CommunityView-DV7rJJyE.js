import{u as V,n as j,o,c as n,a as t,b as E,v as M,e as u,d as i,F as _,r as b,f as h,g as N,i as f,p as S,t as a}from"./index-VVcMOklA.js";import{u as z}from"./community-BSVL4FNw.js";import{f as D}from"./datetime-DA9gX19a.js";const P={class:"space-y-4"},q={class:"card p-4"},R={class:"flex gap-2"},T={class:"mt-3 flex gap-2 overflow-x-auto pb-1"},G=["onClick"],H={class:"mt-2 flex gap-2 overflow-x-auto pb-1"},J=["onClick"],K={key:0,class:"grid grid-cols-1 gap-3"},O=["src"],Q={class:"space-y-2 p-4"},W={class:"flex items-center justify-between"},X={class:"flex items-center gap-2 text-xs text-stone-500"},Y=["src"],Z={key:0,class:"rounded-full bg-amber-100 px-2 py-1 text-[10px] text-amber-700"},ee=["onClick"],te={class:"line-clamp-1 text-base font-semibold"},se={class:"mt-1 line-clamp-2 text-sm text-stone-600"},oe={class:"flex flex-wrap gap-1"},ne={class:"flex items-center gap-3 text-xs text-stone-500"},le=["onClick"],ae=["onClick"],re=["onClick"],ce={key:0,class:"ml-auto rounded-full bg-orange-100 px-2 py-1 text-[10px] text-orange-600"},ue={key:1,class:"card p-6 text-center text-sm text-stone-500"},pe={__name:"CommunityView",setup(ie){const d=N(),x=z(),r=V(),m=h(""),p=h("latest"),v=h("å…¨éƒ¨"),y=h(6),I=[{label:"æœ€æ–°",value:"latest"},{label:"æœ€çƒ­",value:"hot"},{label:"ç²¾å",value:"featured"}],L=f(()=>{const l=new Set(["å…¨éƒ¨","æœæ±","ç½å¤´","æœåˆ‡","å¥åº·"]);return x.posts.forEach(s=>(s.tags||[]).forEach(e=>l.add(e))),Array.from(l)}),C=f(()=>{var l;return x.queryPosts({userId:(l=r.currentUser)==null?void 0:l.id,role:r.role,search:m.value,sort:p.value,tag:v.value,page:1,pageSize:999}).items}),k=f(()=>C.value.slice(0,y.value)),A=f(()=>k.value.length<C.value.length);j([m,p,v],()=>{y.value=6});function B(){y.value+=6}function w(l){return r.users.find(s=>s.id===l)}function F(l){var s;x.toggleLike(l,(s=r.currentUser)==null?void 0:s.id)}function U(l){var s;x.toggleFavorite(l,(s=r.currentUser)==null?void 0:s.id)}return(l,s)=>(o(),n("div",P,[t("section",q,[t("div",R,[E(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),type:"text",placeholder:"æœç´¢æ ‡é¢˜/å†…å®¹/æ ‡ç­¾",class:"flex-1 rounded-xl border border-stone-200 px-3 py-2"},null,512),[[M,m.value]]),t("button",{class:"rounded-xl bg-amber-500 px-3 py-2 text-sm font-semibold text-white",onClick:s[1]||(s[1]=e=>u(d).push("/community/new"))},"å‘å¸–")]),u(r).role==="admin"?(o(),n("button",{key:0,class:"mt-2 rounded-xl border border-amber-400 px-3 py-2 text-xs text-amber-600",onClick:s[2]||(s[2]=e=>u(d).push("/community-manage"))}," è¿›å…¥ç®¡ç†é¢æ¿ ")):i("",!0),t("div",T,[(o(),n(_,null,b(I,e=>t("button",{key:e.value,class:S(["rounded-full px-3 py-1.5 text-xs",p.value===e.value?"bg-amber-500 text-white":"bg-stone-100 text-stone-600"]),onClick:g=>p.value=e.value},a(e.label),11,G)),64))]),t("div",H,[(o(!0),n(_,null,b(L.value,e=>(o(),n("button",{key:e,class:S(["rounded-full px-3 py-1.5 text-xs",v.value===e?"bg-emerald-500 text-white":"bg-stone-100 text-stone-600"]),onClick:g=>v.value=e},a(e),11,J))),128))])]),k.value.length?(o(),n("section",K,[(o(!0),n(_,null,b(k.value,e=>{var g,$;return o(),n("article",{key:e.id,class:"card overflow-hidden"},[e.images[0]?(o(),n("img",{key:0,src:e.images[0],class:"h-48 w-full object-cover"},null,8,O)):i("",!0),t("div",Q,[t("div",W,[t("div",X,[t("img",{src:(g=w(e.authorId))==null?void 0:g.avatar,class:"h-7 w-7 rounded-full object-cover"},null,8,Y),t("span",null,a((($=w(e.authorId))==null?void 0:$.nickname)||"æœªçŸ¥ç”¨æˆ·"),1),t("span",null,"Â· "+a(u(D)(e.createdAt)),1)]),e.isPinned?(o(),n("span",Z,"ç½®é¡¶")):i("",!0)]),t("button",{class:"w-full text-left",onClick:c=>u(d).push(`/community/${e.id}`)},[t("h3",te,a(e.title),1),t("p",se,a(e.content),1)],8,ee),t("div",oe,[(o(!0),n(_,null,b(e.tags,c=>(o(),n("span",{key:c,class:"rounded-full bg-stone-100 px-2 py-1 text-[11px] text-stone-600"},"#"+a(c),1))),128))]),t("div",ne,[t("button",{class:"rounded-lg bg-stone-100 px-2 py-1",onClick:c=>F(e.id)},"ğŸ‘ "+a(e.likeCount),9,le),t("button",{class:"rounded-lg bg-stone-100 px-2 py-1",onClick:c=>U(e.id)},"â­ "+a(e.favoriteCount),9,ae),t("button",{class:"rounded-lg bg-stone-100 px-2 py-1",onClick:c=>u(d).push(`/community/${e.id}`)},"ğŸ’¬ "+a(e.commentCount),9,re),e.isApproved?i("",!0):(o(),n("span",ce,"å¾…å®¡æ ¸"))])])])}),128))])):(o(),n("section",ue,"æš‚æ— å¸–å­ï¼Œå»å‘å¸ƒç¬¬ä¸€æ¡å§ã€‚")),A.value?(o(),n("button",{key:2,class:"w-full rounded-xl border border-stone-300 px-4 py-3 text-sm",onClick:B},"ä¸‹æ‹‰åŠ è½½æ›´å¤š")):i("",!0)]))}};export{pe as default};
