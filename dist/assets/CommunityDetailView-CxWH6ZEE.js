import{u as z,o as l,c as r,F as _,a as e,d as c,t as a,e as x,r as C,b as I,v as B,w as G,k as H,i as p,f as k,g as q,h as J}from"./index-D_8ZP-ZB.js";import{u as K}from"./community-55jVceJj.js";import{a as j}from"./datetime-DA9gX19a.js";const O={key:0,class:"space-y-4"},Q={key:0,class:"card p-4 text-sm text-stone-500"},W={class:"card overflow-hidden"},X=["src"],Y={class:"space-y-3 p-4"},Z={class:"flex items-center gap-2"},ee=["src"],te={class:"text-sm font-medium"},se={class:"text-xs text-stone-500"},oe={key:0,class:"ml-auto rounded-full bg-amber-100 px-2 py-1 text-[10px] text-amber-700"},ne={key:1,class:"rounded-full bg-orange-100 px-2 py-1 text-[10px] text-orange-600"},le={class:"text-xl font-semibold"},re={class:"text-sm leading-6 text-stone-700"},ae={class:"flex flex-wrap gap-1"},ue={key:0,class:"rounded-xl bg-stone-50 p-3 text-xs text-stone-600"},de={class:"flex items-center gap-2 text-sm"},ie={class:"card p-4"},ce={class:"mb-2 text-base font-semibold"},pe={class:"space-y-3"},ve={class:"flex items-center gap-2 text-xs text-stone-500"},xe=["src"],me={class:"mt-1 text-sm text-stone-700"},be={key:0,class:"text-sm text-stone-400"},fe={class:"mt-3 flex gap-2"},ge={key:0,class:"card p-4"},ye={class:"grid grid-cols-2 gap-2 text-sm"},_e={key:1,class:"card p-4"},ke={class:"mx-auto max-w-md space-y-3 rounded-3xl bg-white p-4"},he=["value"],we={class:"grid grid-cols-2 gap-2"},Ce={key:1,class:"card p-4 text-sm text-stone-500"},Ve={__name:"CommunityDetailView",setup(Ie){const M=J(),A=q(),d=K(),u=z(),v=p(()=>String(M.params.id)),U=p(()=>d.getPostById(v.value)),o=p(()=>{var n;return U.value?d.buildPostView(U.value,(n=u.currentUser)==null?void 0:n.id):null}),h=p(()=>d.getCommentsByPost(v.value)),m=k(""),b=k(!1),f=k(""),g=k(""),D=["ä½è´¨å†…å®¹","ç–‘ä¼¼å¹¿å‘Š","ä¸å®ä¿¡æ¯","å…¶ä»–"],$=p(()=>u.users.find(n=>{var t;return n.id===((t=o.value)==null?void 0:t.authorId)})),w=p(()=>u.role==="admin"),F=p(()=>{var n,t;return((n=u.currentUser)==null?void 0:n.id)===((t=o.value)==null?void 0:t.authorId)||w.value}),T=p(()=>{var n;return o.value?w.value?!0:!o.value.isHidden||o.value.authorId===((n=u.currentUser)==null?void 0:n.id):!1});function P(n){return u.users.find(t=>t.id===n)}function E(){var n;m.value.trim()&&(d.addComment({postId:v.value,userId:(n=u.currentUser)==null?void 0:n.id,content:m.value}),m.value="")}function L(){var t;d.addReport({postId:v.value,reporterId:(t=u.currentUser)==null?void 0:t.id,reason:f.value,description:g.value}).success&&(b.value=!1,f.value="",g.value="")}function y(n){d.moderatePost(v.value,n,u.currentUser)}function N(){d.deletePost(v.value,u.currentUser),A.push("/community")}return(n,t)=>{var V,R;return o.value?(l(),r("div",O,[T.value?(l(),r(_,{key:1},[e("section",W,[o.value.images.length?(l(),r("img",{key:0,src:o.value.images[0],class:"h-56 w-full object-cover"},null,8,X)):c("",!0),e("div",Y,[e("div",Z,[e("img",{src:(V=$.value)==null?void 0:V.avatar,class:"h-9 w-9 rounded-full object-cover"},null,8,ee),e("div",null,[e("p",te,a(((R=$.value)==null?void 0:R.nickname)||"æœªçŸ¥ç”¨æˆ·"),1),e("p",se,a(x(j)(o.value.createdAt)),1)]),o.value.isPinned?(l(),r("span",oe,"ç½®é¡¶")):c("",!0),o.value.isApproved?c("",!0):(l(),r("span",ne,"å¾…å®¡æ ¸"))]),e("h1",le,a(o.value.title),1),e("p",re,a(o.value.content),1),e("div",ae,[(l(!0),r(_,null,C(o.value.tags,s=>(l(),r("span",{key:s,class:"rounded-full bg-stone-100 px-2 py-1 text-[11px] text-stone-600"},"#"+a(s),1))),128))]),o.value.recipe?(l(),r("div",ue,[e("p",null,"é…æ–¹æ¨¡å¼ï¼š"+a(o.value.recipe.mode||"-"),1),e("p",null,"æ°´æœï¼š"+a((o.value.recipe.fruits||[]).join?o.value.recipe.fruits.join("ã€"):o.value.recipe.fruits),1),e("p",null,"æ³¨æ°´ï¼š"+a(o.value.recipe.waterMl||0)+" mlï¼Œç³–é‡ï¼š"+a(o.value.recipe.sugarG||0)+" gï¼Œæ¸©åº¦ï¼š"+a(o.value.recipe.temp||"-"),1)])):c("",!0),e("div",de,[e("button",{class:"rounded-xl bg-stone-100 px-3 py-2",onClick:t[0]||(t[0]=s=>{var i;return x(d).toggleLike(o.value.id,(i=x(u).currentUser)==null?void 0:i.id)})}," ğŸ‘ "+a(o.value.likeCount),1),e("button",{class:"rounded-xl bg-stone-100 px-3 py-2",onClick:t[1]||(t[1]=s=>{var i;return x(d).toggleFavorite(o.value.id,(i=x(u).currentUser)==null?void 0:i.id)})}," â­ "+a(o.value.favoriteCount),1),e("button",{class:"rounded-xl bg-stone-100 px-3 py-2",onClick:t[2]||(t[2]=s=>b.value=!0)},"ä¸¾æŠ¥")])])]),e("section",ie,[e("h2",ce,"è¯„è®ºï¼ˆ"+a(h.value.length)+"ï¼‰",1),e("div",pe,[(l(!0),r(_,null,C(h.value,s=>{var i,S;return l(),r("article",{key:s.id,class:"rounded-xl border border-stone-200 p-3"},[e("div",ve,[e("img",{src:(i=P(s.userId))==null?void 0:i.avatar,class:"h-6 w-6 rounded-full object-cover"},null,8,xe),e("span",null,a(((S=P(s.userId))==null?void 0:S.nickname)||"åŒ¿åç”¨æˆ·"),1),e("span",null,a(x(j)(s.createdAt)),1)]),e("p",me,a(s.content),1)])}),128)),h.value.length?c("",!0):(l(),r("p",be,"æš‚æ— è¯„è®º"))]),e("div",fe,[I(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>m.value=s),type:"text",placeholder:"è¯´ç‚¹ä»€ä¹ˆ...",class:"flex-1 rounded-xl border border-stone-200 px-3 py-2"},null,512),[[B,m.value]]),e("button",{class:"rounded-xl bg-amber-500 px-3 py-2 text-sm font-semibold text-white",onClick:E},"å‘é€")])]),w.value?(l(),r("section",ge,[t[12]||(t[12]=e("h2",{class:"mb-2 text-base font-semibold"},"ç®¡ç†å‘˜æ“ä½œ",-1)),e("div",ye,[e("button",{class:"rounded-xl border border-stone-300 px-3 py-2",onClick:t[4]||(t[4]=s=>y("approve"))},"å®¡æ ¸é€šè¿‡"),e("button",{class:"rounded-xl border border-stone-300 px-3 py-2",onClick:t[5]||(t[5]=s=>y("pin"))},"ç½®é¡¶/å–æ¶ˆç½®é¡¶"),e("button",{class:"rounded-xl border border-stone-300 px-3 py-2",onClick:t[6]||(t[6]=s=>y("hide"))},"éšè—"),e("button",{class:"rounded-xl border border-stone-300 px-3 py-2",onClick:t[7]||(t[7]=s=>y("show"))},"å–æ¶ˆéšè—")])])):c("",!0),F.value?(l(),r("section",_e,[e("button",{class:"w-full rounded-xl border border-red-300 px-3 py-2 text-sm text-red-500",onClick:N},"åˆ é™¤å¸–å­")])):c("",!0)],64)):(l(),r("section",Q,"è¯¥å¸–å­å·²éšè—ï¼Œæš‚æ— æƒé™æŸ¥çœ‹ã€‚")),b.value?(l(),r("div",{key:2,class:"fixed inset-0 z-[65] bg-black/50 p-3",onClick:t[11]||(t[11]=G(s=>b.value=!1,["self"]))},[e("div",ke,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold"},"ä¸¾æŠ¥å¸–å­",-1)),I(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>f.value=s),class:"w-full rounded-xl border border-stone-200 px-3 py-2"},[t[13]||(t[13]=e("option",{value:""},"é€‰æ‹©åŸå› ",-1)),(l(),r(_,null,C(D,s=>e("option",{key:s,value:s},a(s),9,he)),64))],512),[[H,f.value]]),I(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>g.value=s),rows:"3",placeholder:"è¡¥å……è¯´æ˜ï¼ˆå¯é€‰ï¼‰",class:"w-full rounded-xl border border-stone-200 px-3 py-2"},null,512),[[B,g.value]]),e("div",we,[e("button",{class:"rounded-xl border border-stone-300 px-3 py-2",onClick:t[10]||(t[10]=s=>b.value=!1)},"å–æ¶ˆ"),e("button",{class:"rounded-xl bg-amber-500 px-3 py-2 font-semibold text-white",onClick:L},"æäº¤ä¸¾æŠ¥")])])])):c("",!0)])):(l(),r("div",Ce,"å¸–å­ä¸å­˜åœ¨"))}}};export{Ve as default};
