import{u as X,f,o as l,c as o,a as t,e as i,t as a,d,F as m,r as x,b as v,v as _,j as Y,k as Z,l as E,m as L,g as ee,i as U,z as te}from"./index-DkfAZXiR.js";import{u as se}from"./community-BGzd6QHW.js";import{u as le}from"./production-CQtRph0L.js";import{_ as oe}from"./ImageField-Dax1EdUO.js";import{a as k}from"./datetime-DA9gX19a.js";import"./ImageEditor-DJcDNQea.js";const re={class:"space-y-4"},ae={class:"card p-4"},ne={class:"flex items-center gap-3"},ue=["src"],ie={class:"text-lg font-semibold"},de={class:"text-xs text-stone-500"},ce={class:"mt-3 grid grid-cols-2 gap-2 text-xs"},pe={class:"card p-2"},me={class:"flex gap-2 overflow-x-auto pb-1"},xe=["onClick"],ve={key:0,class:"card space-y-3 p-4"},ye={class:"grid grid-cols-2 gap-2"},ge={class:"rounded-xl bg-stone-50 p-3"},be={class:"mt-2 flex gap-3 text-sm"},fe={class:"mt-2 flex gap-2"},_e={class:"mt-2 flex flex-wrap gap-2"},ke=["onClick"],he={key:0,class:"rounded-xl bg-green-50 px-3 py-2 text-xs text-green-600"},Ue={key:1,class:"space-y-3"},we={class:"text-sm font-medium"},Ce={class:"mt-1 text-xs text-stone-500"},Ve={key:0,class:"card p-4 text-sm text-stone-500"},Se={key:2,class:"space-y-3"},Pe={class:"text-sm font-medium"},Fe={class:"mt-1 text-xs text-stone-500"},Ae={key:0,class:"card p-4 text-sm text-stone-500"},Be={key:3,class:"space-y-3"},je={class:"text-sm font-medium"},$e={key:0,class:"card p-4 text-sm text-stone-500"},Me={key:4,class:"space-y-3"},Ne={class:"text-sm font-medium"},Te={key:0,class:"card p-4 text-sm text-stone-500"},De={key:5,class:"space-y-3"},Ie={class:"text-sm"},ze={class:"mt-1 text-xs text-stone-500"},He={key:0,class:"card p-4 text-sm text-stone-500"},Re={key:6,class:"space-y-3"},Ee={class:"flex items-center justify-between"},Le={class:"text-sm font-medium"},qe={class:"text-xs text-stone-400"},Ge=["src"],Je={key:0,class:"card p-4 text-sm text-stone-500"},et={__name:"MyView",setup(Ke){var S,P,F,A,B,j,$,M,N,T,D;const h=ee(),n=X(),w=se(),q=le(),p=f("profile"),y=f(""),g=f(""),r=f({nickname:((S=n.currentUser)==null?void 0:S.nickname)||"",avatar:((P=n.currentUser)==null?void 0:P.avatar)||"",gender:((F=n.currentUser)==null?void 0:F.gender)||"",birthday:((A=n.currentUser)==null?void 0:A.birthday)||"",region:((B=n.currentUser)==null?void 0:B.region)||"",lowSugar:!!(($=(j=n.currentUser)==null?void 0:j.preference)!=null&&$.lowSugar),highFiber:!!((N=(M=n.currentUser)==null?void 0:M.preference)!=null&&N.highFiber),allergies:[...((D=(T=n.currentUser)==null?void 0:T.preference)==null?void 0:D.allergies)||[]]}),G=[{key:"profile",label:"资料"},{key:"recipes",label:"我的配方"},{key:"posts",label:"我的帖子"},{key:"favorites",label:"收藏"},{key:"likes",label:"点赞"},{key:"comments",label:"评论"},{key:"history",label:"历史制作"}],c=U(()=>{var u;return w.getUserContent((u=n.currentUser)==null?void 0:u.id)}),C=U(()=>c.value.myPosts.filter(u=>u.recipe)),V=U(()=>{var u;return q.getHistoryByUser((u=n.currentUser)==null?void 0:u.id)});function J(u){var s;return((s=w.getPostById(u))==null?void 0:s.title)||"帖子已删除"}function K(){const u=y.value.trim();u&&(r.value.allergies.includes(u)||r.value.allergies.push(u),y.value="")}function O(u){r.value.allergies=r.value.allergies.filter(s=>s!==u)}function Q(){if(!r.value.nickname||!r.value.avatar){g.value="昵称和头像为必填";return}n.updateProfile({nickname:r.value.nickname,avatar:r.value.avatar,gender:r.value.gender,birthday:r.value.birthday,region:r.value.region,preference:{lowSugar:r.value.lowSugar,highFiber:r.value.highFiber,allergies:r.value.allergies}}),g.value="资料已保存"}function W(){n.logout(),h.push("/login")}return(u,s)=>{var I,z,H,R;return l(),o("div",re,[t("section",ae,[t("div",ne,[t("img",{src:(I=i(n).currentUser)==null?void 0:I.avatar,class:"h-14 w-14 rounded-full object-cover"},null,8,ue),t("div",null,[t("p",ie,a((z=i(n).currentUser)==null?void 0:z.nickname),1),t("p",de,"账号："+a((H=i(n).currentUser)==null?void 0:H.account)+" · 角色："+a((R=i(n).currentUser)==null?void 0:R.role),1)])]),t("div",ce,[i(n).role==="admin"?(l(),o("button",{key:0,class:"rounded-xl border border-amber-400 px-3 py-2 text-amber-600",onClick:s[0]||(s[0]=e=>i(h).push("/community-manage"))},"社区管理")):d("",!0),["admin","maintainer"].includes(i(n).role)?(l(),o("button",{key:1,class:"rounded-xl border border-emerald-400 px-3 py-2 text-emerald-600",onClick:s[1]||(s[1]=e=>i(h).push("/maintainer"))},"设备状态")):d("",!0)])]),t("section",pe,[t("div",me,[(l(),o(m,null,x(G,e=>t("button",{key:e.key,class:te(["whitespace-nowrap rounded-full px-3 py-1.5 text-xs",p.value===e.key?"bg-amber-500 text-white":"bg-stone-100 text-stone-600"]),onClick:b=>p.value=e.key},a(e.label),11,xe)),64))])]),p.value==="profile"?(l(),o("section",ve,[v(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>r.value.nickname=e),type:"text",placeholder:"昵称（必填）",class:"w-full rounded-xl border border-stone-200 px-3 py-2"},null,512),[[_,r.value.nickname]]),Y(oe,{modelValue:r.value.avatar,"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.avatar=e),label:"头像（必填）","aspect-hint":"1:1"},null,8,["modelValue"]),t("div",ye,[v(t("select",{"onUpdate:modelValue":s[4]||(s[4]=e=>r.value.gender=e),class:"rounded-xl border border-stone-200 px-3 py-2"},[...s[10]||(s[10]=[t("option",{value:""},"性别",-1),t("option",{value:"男"},"男",-1),t("option",{value:"女"},"女",-1),t("option",{value:"保密"},"保密",-1)])],512),[[Z,r.value.gender]]),v(t("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>r.value.birthday=e),type:"date",class:"rounded-xl border border-stone-200 px-3 py-2"},null,512),[[_,r.value.birthday]])]),v(t("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>r.value.region=e),type:"text",placeholder:"地区",class:"w-full rounded-xl border border-stone-200 px-3 py-2"},null,512),[[_,r.value.region]]),t("div",ge,[s[13]||(s[13]=t("p",{class:"text-sm font-medium"},"偏好设置",-1)),t("div",be,[t("label",null,[v(t("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>r.value.lowSugar=e),type:"checkbox",class:"mr-1"},null,512),[[E,r.value.lowSugar]]),s[11]||(s[11]=L("低糖",-1))]),t("label",null,[v(t("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>r.value.highFiber=e),type:"checkbox",class:"mr-1"},null,512),[[E,r.value.highFiber]]),s[12]||(s[12]=L("高纤维",-1))])]),t("div",fe,[v(t("input",{"onUpdate:modelValue":s[9]||(s[9]=e=>y.value=e),type:"text",placeholder:"过敏源自定义",class:"flex-1 rounded-xl border border-stone-200 px-3 py-2 text-xs"},null,512),[[_,y.value]]),t("button",{class:"rounded-xl border border-amber-500 px-3 py-2 text-xs text-amber-600",onClick:K},"添加")]),t("div",_e,[(l(!0),o(m,null,x(r.value.allergies,e=>(l(),o("button",{key:e,class:"rounded-full bg-amber-100 px-3 py-1 text-xs text-amber-700",onClick:b=>O(e)},a(e)+" × ",9,ke))),128))])]),g.value?(l(),o("p",he,a(g.value),1)):d("",!0),t("button",{class:"w-full rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:Q},"保存资料"),t("button",{class:"w-full rounded-xl border border-red-300 px-4 py-3 text-red-500",onClick:W},"退出登录")])):p.value==="recipes"?(l(),o("section",Ue,[(l(!0),o(m,null,x(C.value,e=>{var b;return l(),o("article",{key:e.id,class:"card p-4"},[t("p",we,a(e.title),1),t("p",Ce,"模式："+a((b=e.recipe)==null?void 0:b.mode)+" · "+a(i(k)(e.createdAt)),1)])}),128)),C.value.length?d("",!0):(l(),o("p",Ve,"暂无配方帖子"))])):p.value==="posts"?(l(),o("section",Se,[(l(!0),o(m,null,x(c.value.myPosts,e=>(l(),o("article",{key:e.id,class:"card p-4"},[t("p",Pe,a(e.title),1),t("p",Fe,a(e.isApproved?"已审核":"待审核")+" · "+a(i(k)(e.createdAt)),1)]))),128)),c.value.myPosts.length?d("",!0):(l(),o("p",Ae,"暂无帖子"))])):p.value==="favorites"?(l(),o("section",Be,[(l(!0),o(m,null,x(c.value.favoritePosts,e=>(l(),o("article",{key:e.id,class:"card p-4"},[t("p",je,a(e.title),1),s[14]||(s[14]=t("p",{class:"mt-1 text-xs text-stone-500"},"收藏",-1))]))),128)),c.value.favoritePosts.length?d("",!0):(l(),o("p",$e,"暂无收藏"))])):p.value==="likes"?(l(),o("section",Me,[(l(!0),o(m,null,x(c.value.likedPosts,e=>(l(),o("article",{key:e.id,class:"card p-4"},[t("p",Ne,a(e.title),1),s[15]||(s[15]=t("p",{class:"mt-1 text-xs text-stone-500"},"已点赞",-1))]))),128)),c.value.likedPosts.length?d("",!0):(l(),o("p",Te,"暂无点赞"))])):p.value==="comments"?(l(),o("section",De,[(l(!0),o(m,null,x(c.value.myComments,e=>(l(),o("article",{key:e.id,class:"card p-4"},[t("p",Ie,a(e.content),1),t("p",ze,"帖子："+a(J(e.postId))+" · "+a(i(k)(e.createdAt)),1)]))),128)),c.value.myComments.length?d("",!0):(l(),o("p",He,"暂无评论"))])):(l(),o("section",Re,[(l(!0),o(m,null,x(V.value,e=>(l(),o("article",{key:e.id,class:"card p-4"},[t("div",Ee,[t("p",Le,a(e.mode==="juice"?"果汁":e.mode==="canned"?"罐头":"果切")+" · "+a(e.fruitCount)+" 个水果",1),t("span",qe,a(i(k)(e.createdAt)),1)]),e.image?(l(),o("img",{key:0,src:e.image,class:"mt-2 h-28 w-full rounded-xl object-cover"},null,8,Ge)):d("",!0)]))),128)),V.value.length?d("",!0):(l(),o("p",Je,"暂无制作历史"))]))])}}};export{et as default};
