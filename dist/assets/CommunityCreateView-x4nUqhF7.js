import{u as D,o as r,c as u,a as t,b as d,v as p,F as k,r as w,l as E,m as M,k as O,d as h,t as v,e as L,j as P,w as q,f as i,g as H,z as J}from"./index-CooPFdbs.js";import{u as K}from"./community-DQ3ys79n.js";import{I as Q}from"./ImageEditor-62VxGMNA.js";const X={class:"space-y-4"},Y={class:"card space-y-3 p-4"},Z={class:"flex flex-wrap gap-2"},ee=["onClick"],te={class:"mt-2 flex gap-2"},le={class:"card space-y-3 p-4"},se={class:"flex items-center justify-between"},oe={class:"text-xs text-stone-600"},ne={key:0,class:"grid grid-cols-2 gap-2"},ae={class:"card space-y-3 p-4"},re={class:"flex items-center justify-between"},ue={class:"text-sm font-medium"},ie={class:"rounded-xl border border-dashed border-stone-300 px-3 py-2 text-xs text-stone-600"},de={key:0,class:"grid grid-cols-3 gap-2"},pe=["src"],ce={class:"absolute inset-x-0 bottom-0 grid grid-cols-3 bg-black/50 text-[10px] text-white"},ve=["onClick"],xe=["onClick"],me=["onClick"],ge={key:0,class:"rounded-xl bg-red-50 px-3 py-2 text-xs text-red-500"},fe={class:"grid grid-cols-2 gap-2"},be={class:"mx-auto max-h-full max-w-xl overflow-y-auto rounded-3xl bg-white p-4"},ye={class:"mt-2 text-base font-semibold"},ke={class:"mt-1 text-sm text-stone-600"},we={class:"mt-2 flex flex-wrap gap-1"},he={class:"mt-3 grid grid-cols-2 gap-2"},Ce=["src"],Me={__name:"CommunityCreateView",setup(_e){const C=H(),F=K(),I=D(),s=i({title:"",content:"",tags:["果汁"],recipeMode:"juice",recipeFruits:"",recipeWaterMl:100,recipeSugarG:10,recipeTemp:"冷饮"}),a=i([]),g=i(""),f=i(!0),b=i(!1),x=i(""),m=i(!1),y=i(""),c=i(-1),_=i(-1),S=i(null),T=["果汁","罐头","果切","健康","家庭","创意"];function U(o){return new Promise((e,l)=>{const n=new FileReader;n.onload=()=>e(String(n.result||"")),n.onerror=l,n.readAsDataURL(o)})}async function $(o){const e=Array.from(o.target.files||[]);for(const l of e){if(a.value.length>=9)break;const n=await U(l);a.value.push(n)}a.value.length&&(c.value=a.value.length-1,y.value=a.value[c.value],m.value=!0),o.target.value=""}function R(o){s.value.tags.includes(o)?s.value.tags=s.value.tags.filter(e=>e!==o):s.value.tags.push(o)}function j(){const o=g.value.trim();o&&(s.value.tags.includes(o)||s.value.tags.push(o),g.value="")}function N(o){c.value=o,y.value=a.value[o],m.value=!0}function G(o){var e;_.value=o,(e=S.value)==null||e.click()}async function W(o){const[e]=o.target.files||[];if(!e)return;const l=await U(e);c.value=_.value,y.value=l,m.value=!0,o.target.value=""}function z(o){a.value.splice(o,1)}function A(o){c.value>=0&&(a.value[c.value]=o.image)}function B(){if(x.value="",!s.value.title.trim()||!s.value.content.trim()){x.value="标题和正文必填";return}const o=f.value?{mode:s.value.recipeMode,fruits:s.value.recipeFruits,waterMl:Number(s.value.recipeWaterMl),sugarG:Number(s.value.recipeSugarG),temp:s.value.recipeTemp}:null,e=F.createPost({title:s.value.title,content:s.value.content,tags:s.value.tags,images:a.value,recipe:o},I.currentUser);if(!e.success){x.value=e.message;return}C.replace(`/community/${e.data.id}`)}return(o,e)=>(r(),u("div",X,[e[20]||(e[20]=t("section",{class:"card p-4"},[t("h2",{class:"text-lg font-semibold"},"发布帖子"),t("p",{class:"mt-1 text-xs text-stone-500"},"支持 1~9 张图片，每张可编辑和替换。")],-1)),t("section",Y,[d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.title=l),type:"text",placeholder:"标题",class:"w-full rounded-xl border border-stone-200 px-3 py-2"},null,512),[[p,s.value.title]]),d(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.content=l),rows:"4",placeholder:"正文",class:"w-full rounded-xl border border-stone-200 px-3 py-2"},null,512),[[p,s.value.content]]),t("div",null,[e[14]||(e[14]=t("p",{class:"mb-2 text-xs text-stone-500"},"标签",-1)),t("div",Z,[(r(),u(k,null,w(T,l=>t("button",{key:l,class:J(["rounded-full px-3 py-1 text-xs",s.value.tags.includes(l)?"bg-amber-500 text-white":"bg-stone-100 text-stone-600"]),onClick:n=>R(l)},v(l),11,ee)),64))]),t("div",te,[d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),type:"text",placeholder:"自定义标签",class:"flex-1 rounded-xl border border-stone-200 px-3 py-2 text-xs"},null,512),[[p,g.value]]),t("button",{class:"rounded-xl border border-amber-500 px-3 py-2 text-xs text-amber-600",onClick:j},"添加")])])]),t("section",le,[t("div",se,[e[16]||(e[16]=t("p",{class:"text-sm font-medium"},"配方字段（可选）",-1)),t("label",oe,[d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),type:"checkbox",class:"mr-1"},null,512),[[E,f.value]]),e[15]||(e[15]=M("启用",-1))])]),f.value?(r(),u("div",ne,[d(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.recipeMode=l),class:"rounded-xl border border-stone-200 px-3 py-2"},[...e[17]||(e[17]=[t("option",{value:"juice"},"果汁",-1),t("option",{value:"canned"},"罐头",-1),t("option",{value:"cut"},"果切",-1)])],512),[[O,s.value.recipeMode]]),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.recipeTemp=l),type:"text",placeholder:"温度",class:"rounded-xl border border-stone-200 px-3 py-2"},null,512),[[p,s.value.recipeTemp]]),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.recipeFruits=l),type:"text",placeholder:"水果结构化描述",class:"col-span-2 rounded-xl border border-stone-200 px-3 py-2"},null,512),[[p,s.value.recipeFruits]]),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.recipeWaterMl=l),type:"number",placeholder:"注水 ml",class:"rounded-xl border border-stone-200 px-3 py-2"},null,512),[[p,s.value.recipeWaterMl]]),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.recipeSugarG=l),type:"number",placeholder:"糖量 g",class:"rounded-xl border border-stone-200 px-3 py-2"},null,512),[[p,s.value.recipeSugarG]])])):h("",!0)]),t("section",ae,[t("div",re,[t("p",ue,"配图（"+v(a.value.length)+"/9）",1),t("label",ie,[e[18]||(e[18]=M(" 添加图片 ",-1)),t("input",{type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:$},null,32)])]),a.value.length?(r(),u("div",de,[(r(!0),u(k,null,w(a.value,(l,n)=>(r(),u("div",{key:n,class:"relative overflow-hidden rounded-xl border border-stone-200"},[t("img",{src:l,class:"h-24 w-full object-cover"},null,8,pe),t("div",ce,[t("button",{class:"py-1",onClick:V=>N(n)},"编辑",8,ve),t("button",{class:"py-1",onClick:V=>G(n)},"替换",8,xe),t("button",{class:"py-1",onClick:V=>z(n)},"删除",8,me)])]))),128))])):h("",!0),t("button",{class:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm",onClick:e[9]||(e[9]=l=>b.value=!0)},"发帖预览")]),x.value?(r(),u("p",ge,v(x.value),1)):h("",!0),t("div",fe,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:e[10]||(e[10]=l=>L(C).push("/community"))},"取消"),t("button",{class:"rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:B},"发布")]),t("input",{ref_key:"replaceInputRef",ref:S,type:"file",accept:"image/*",class:"hidden",onChange:W},null,544),P(Q,{open:m.value,"onUpdate:open":e[11]||(e[11]=l=>m.value=l),src:y.value,title:"编辑帖子图片",onSave:A},null,8,["open","src"]),b.value?(r(),u("div",{key:1,class:"fixed inset-0 z-[65] bg-black/50 p-3",onClick:e[13]||(e[13]=q(l=>b.value=!1,["self"]))},[t("div",be,[e[19]||(e[19]=t("h3",{class:"text-lg font-semibold"},"发帖预览",-1)),t("p",ye,v(s.value.title||"（未填写标题）"),1),t("p",ke,v(s.value.content||"（未填写正文）"),1),t("div",we,[(r(!0),u(k,null,w(s.value.tags,l=>(r(),u("span",{key:l,class:"rounded-full bg-stone-100 px-2 py-1 text-[11px] text-stone-600"},"#"+v(l),1))),128))]),t("div",he,[(r(!0),u(k,null,w(a.value,(l,n)=>(r(),u("img",{key:n,src:l,class:"h-32 w-full rounded-xl object-cover"},null,8,Ce))),128))]),t("button",{class:"mt-4 w-full rounded-xl border border-stone-300 px-4 py-2.5",onClick:e[12]||(e[12]=l=>b.value=!1)},"关闭预览")])])):h("",!0)]))}};export{Me as default};
