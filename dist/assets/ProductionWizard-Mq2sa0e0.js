import{u as w}from"./production-ObipV6Zr.js";import{f as g,n as V,o as i,c as p,a as t,t as u,F as C,r as h,p as _,e as l,A as M,i as $,q as T,s as j,x as N,g as I,u as B,j as D,d as F,y as z,z as A}from"./index-VVcMOklA.js";import{_ as P}from"./ImageField-Cs9XF6YH.js";import"./ImageEditor-DWOalTW5.js";const R={class:"space-y-4"},U={class:"card p-4"},O={class:"mt-4 flex items-center justify-center gap-4"},E={class:"rounded-2xl bg-amber-50 px-5 py-2 text-2xl font-bold text-amber-600"},L={class:"grid grid-cols-3 gap-2"},q=["src"],H={__name:"Step1Placement",emits:["next"],setup(k,{emit:m}){const b=m,n=w(),s=g(n.draft.fruitCount);V(s,f=>{const c=Math.max(1,Math.min(6,Number(f||1)));c!==f&&(s.value=c)});function d(){s.value=Math.max(1,s.value-1)}function a(){s.value=Math.min(6,s.value+1)}function o(){n.setFruitCount(s.value),b("next")}return(f,c)=>(i(),p("div",R,[t("div",U,[c[0]||(c[0]=t("h2",{class:"text-lg font-semibold"},"步骤1：水果安放",-1)),c[1]||(c[1]=t("p",{class:"mt-1 text-sm text-stone-500"},"请先放置水果，再确认数量（1-6个）。",-1)),t("div",O,[t("button",{class:"h-10 w-10 rounded-full bg-stone-100 text-xl",onClick:d},"-"),t("div",E,u(s.value),1),t("button",{class:"h-10 w-10 rounded-full bg-stone-100 text-xl",onClick:a},"+")])]),t("div",L,[(i(),p(C,null,h(6,v=>t("div",{key:v,class:_(["overflow-hidden rounded-xl border",v<=s.value?"border-amber-300 bg-amber-50":"border-stone-200 bg-stone-100 opacity-50"])},[t("img",{src:l(M).fruits[(v-1)%l(M).fruits.length],class:"h-20 w-full object-cover"},null,8,q)],2)),64))]),t("button",{class:"w-full rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:o},"继续：水果预处理")]))}},J={class:"space-y-4"},W={class:"space-y-3"},G={class:"mb-3 text-sm font-medium"},K={class:"grid grid-cols-3 gap-2 text-sm"},Q=["onClick"],X=["onClick"],Y={class:"grid grid-cols-2 gap-2"},Z={__name:"Step2Preprocess",emits:["next","back"],setup(k,{emit:m}){const b=m,n=w();function s(d,a){const o=n.draft.fruits[d];!o||a==="cutting"||n.updateFruit(d,{[a]:!o[a]})}return(d,a)=>(i(),p("div",J,[a[3]||(a[3]=t("div",{class:"card p-4"},[t("h2",{class:"text-lg font-semibold"},"步骤2：水果预处理"),t("p",{class:"mt-1 text-sm text-stone-500"},"去核/削皮可选；切块必选且不可取消。")],-1)),t("div",W,[(i(!0),p(C,null,h(l(n).draft.fruits,(o,f)=>(i(),p("div",{key:o.id,class:"card p-4"},[t("p",G,"水果 "+u(o.id),1),t("div",K,[t("button",{class:_(["rounded-xl border px-2 py-2",o.pitting?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:c=>s(f,"pitting")}," 去核 "+u(o.pitting?"✓":""),11,Q),t("button",{class:_(["rounded-xl border px-2 py-2",o.peeling?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:c=>s(f,"peeling")}," 削皮 "+u(o.peeling?"✓":""),11,X),a[2]||(a[2]=t("div",{class:"rounded-xl border border-emerald-300 bg-emerald-50 px-2 py-2 text-center text-emerald-700"}," 切块 ✓ ",-1))])]))),128))]),t("div",Y,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:a[0]||(a[0]=o=>b("back"))},"上一步"),t("button",{class:"rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:a[1]||(a[1]=o=>b("next"))},"继续：处理方案")])]))}},tt={class:"space-y-4"},et={key:0,class:"grid grid-cols-1 gap-3"},st={key:1,class:"card space-y-3 p-4"},nt={class:"font-medium"},ot=["src"],rt=["href"],at={class:"grid grid-cols-2 gap-2"},lt={key:2,class:"space-y-3"},dt={key:0,class:"card space-y-3 p-4"},it={class:"grid grid-cols-3 gap-2"},ut=["onClick"],ct=["value"],pt={class:"mt-1 text-xs text-stone-600"},mt={class:"grid grid-cols-2 gap-2"},xt=["value"],bt={class:"mt-1 text-xs text-stone-600"},ft={key:1,class:"card space-y-3 p-4"},vt=["value"],gt={class:"mt-1 text-xs text-stone-600"},_t=["value"],yt={class:"mt-1 text-xs text-stone-600"},$t={class:"grid grid-cols-2 gap-2"},kt={__name:"Step3Scheme",emits:["next","back"],setup(k,{emit:m}){const b=m,n=w(),s=g(n.draft.mode?"blade":"mode"),d=g(n.draft.mode||"juice"),a=$(()=>d.value==="juice"?"果汁":d.value==="canned"?"罐头":"果切"),o=["冷饮","常温","热饮"],f=["细腻无渣","微渣口感","高纤维"];function c(x){d.value=x,s.value="blade"}function v(){if(n.setMode(d.value),d.value==="cut"){b("next");return}s.value="settings"}function y(){b("next")}return(x,e)=>(i(),p("div",tt,[e[23]||(e[23]=t("div",{class:"card p-4"},[t("h2",{class:"text-lg font-semibold"},"步骤3：处理方案选择"),t("p",{class:"mt-1 text-sm text-stone-500"},"果汁 / 罐头 / 果切")],-1)),s.value==="mode"?(i(),p("section",et,[t("button",{class:"card p-4 text-left",onClick:e[0]||(e[0]=r=>c("juice"))},[...e[12]||(e[12]=[t("p",{class:"text-base font-semibold"},"果汁",-1),t("p",{class:"text-xs text-stone-500"},"支持滤网口感、温度、甜度配置",-1)])]),t("button",{class:"card p-4 text-left",onClick:e[1]||(e[1]=r=>c("canned"))},[...e[13]||(e[13]=[t("p",{class:"text-base font-semibold"},"罐头",-1),t("p",{class:"text-xs text-stone-500"},"支持温度和甜度配置",-1)])]),t("button",{class:"card p-4 text-left",onClick:e[2]||(e[2]=r=>c("cut"))},[...e[14]||(e[14]=[t("p",{class:"text-base font-semibold"},"果切",-1),t("p",{class:"text-xs text-stone-500"},"完成刀头检查后可直接制作",-1)])])])):s.value==="blade"?(i(),p("section",st,[t("p",nt,"刀头检查（"+u(a.value)+"）",1),t("img",{src:l(M).bladeImages[d.value],class:"h-44 w-full rounded-xl object-cover"},null,8,ot),t("a",{href:l(M).bladeVideos[d.value],target:"_blank",class:"text-sm text-amber-600 underline"},"查看刀头更换视频（占位链接）",8,rt),t("div",at,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-2",onClick:e[3]||(e[3]=r=>s.value="mode")},"重新选方案"),t("button",{class:"rounded-xl bg-amber-500 px-4 py-2 font-semibold text-white",onClick:v},"已检查完成")])])):(i(),p("section",lt,[d.value==="juice"?(i(),p("div",dt,[e[19]||(e[19]=t("p",{class:"font-medium"},"果汁参数",-1)),t("div",null,[e[15]||(e[15]=t("p",{class:"mb-2 text-xs text-stone-500"},"滤网口感",-1)),t("div",it,[(i(),p(C,null,h(f,r=>t("button",{key:r,class:_(["rounded-xl border px-2 py-2 text-xs",l(n).draft.settings.texture===r?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:S=>l(n).updateSettings({texture:r})},u(r),11,ut)),64))])]),t("div",null,[e[16]||(e[16]=t("p",{class:"mb-2 text-xs text-stone-500"},"温度",-1)),t("input",{type:"range",min:"0",max:"2",step:"1",value:o.indexOf(l(n).draft.settings.temperature),class:"w-full accent-amber-500",onInput:e[4]||(e[4]=r=>l(n).updateSettings({temperature:o[Number(r.target.value)]}))},null,40,ct),t("p",pt,"当前："+u(l(n).draft.settings.temperature),1)]),t("div",null,[e[17]||(e[17]=t("p",{class:"mb-2 text-xs text-stone-500"},"甜度",-1)),t("div",mt,[t("button",{class:_(["rounded-xl border px-2 py-2 text-xs",l(n).draft.settings.sweetnessType==="自定义"?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:e[5]||(e[5]=r=>l(n).updateSettings({sweetnessType:"自定义"}))},"自定义",2),t("button",{class:_(["rounded-xl border px-2 py-2 text-xs",l(n).draft.settings.sweetnessType==="健康推荐"?"border-amber-400 bg-amber-50 text-amber-700":"border-stone-200"]),onClick:e[6]||(e[6]=r=>l(n).updateSettings({sweetnessType:"健康推荐",sweetnessValue:20}))},"健康推荐",2)]),t("input",{type:"range",min:"0",max:"100",step:"1",class:"mt-2 w-full accent-amber-500",value:l(n).draft.settings.sweetnessValue,onInput:e[7]||(e[7]=r=>l(n).updateSettings({sweetnessValue:Number(r.target.value)}))},null,40,xt),t("p",bt,"甜度："+u(l(n).draft.settings.sweetnessValue)+"%",1),e[18]||(e[18]=t("p",{class:"text-xs text-emerald-600"},"建议：低糖用户可控制在 0~30%。",-1))])])):(i(),p("div",ft,[e[22]||(e[22]=t("p",{class:"font-medium"},"罐头参数",-1)),t("div",null,[e[20]||(e[20]=t("p",{class:"mb-2 text-xs text-stone-500"},"温度",-1)),t("input",{type:"range",min:"0",max:"2",step:"1",value:o.indexOf(l(n).draft.settings.cannedTemperature),class:"w-full accent-amber-500",onInput:e[8]||(e[8]=r=>l(n).updateSettings({cannedTemperature:o[Number(r.target.value)]}))},null,40,vt),t("p",gt,"当前："+u(l(n).draft.settings.cannedTemperature),1)]),t("div",null,[e[21]||(e[21]=t("p",{class:"mb-2 text-xs text-stone-500"},"甜度",-1)),t("input",{type:"range",min:"0",max:"100",step:"1",value:l(n).draft.settings.cannedSweetness,class:"w-full accent-amber-500",onInput:e[9]||(e[9]=r=>l(n).updateSettings({cannedSweetness:Number(r.target.value)}))},null,40,_t),t("p",yt,"当前："+u(l(n).draft.settings.cannedSweetness)+"%",1)])])),t("div",$t,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:e[10]||(e[10]=r=>s.value="blade")},"返回刀头检查"),t("button",{class:"rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:y},"继续：制作监控")])])),t("button",{class:"w-full rounded-xl border border-stone-300 px-4 py-2",onClick:e[11]||(e[11]=r=>b("back"))},"返回上一步")]))}},wt={class:"space-y-4"},Ct={class:"card p-4"},ht={class:"mb-2 flex items-center justify-between text-sm"},St={class:"font-semibold text-amber-600"},Mt={class:"h-3 overflow-hidden rounded-full bg-stone-100"},Vt={class:"mt-2 text-xs text-stone-500"},Tt={class:"card p-4"},jt={class:"grid grid-cols-3 gap-2 text-sm"},Nt={class:"grid grid-cols-2 gap-2"},It=["disabled"],Bt={__name:"Step4Monitor",emits:["next","back"],setup(k,{emit:m}){const b=m,n=w(),s=g(0),d=g(!1),a=g([]);let o=null;const f=$(()=>Math.max(8e3,n.draft.fruitCount*3500)),c=$(()=>Math.max(0,Math.round(f.value*(1-s.value/100)/1e3)));function v(){const x=100/(f.value/200);o=window.setInterval(()=>{s.value=Math.min(100,s.value+x);const e=Math.floor(s.value/100*n.draft.fruitCount);a.value=Array.from({length:e},(r,S)=>S+1),s.value>=100&&(d.value=!0,window.clearInterval(o),o=null)},200)}return T(()=>{v()}),j(()=>{o&&window.clearInterval(o)}),(y,x)=>(i(),p("div",wt,[x[4]||(x[4]=t("div",{class:"card p-4"},[t("h2",{class:"text-lg font-semibold"},"步骤4：制作与监控"),t("p",{class:"mt-1 text-sm text-stone-500"},"正在按设定参数处理水果。")],-1)),t("div",Ct,[t("div",ht,[x[2]||(x[2]=t("span",null,"当前进度",-1)),t("span",St,u(Math.round(s.value))+"%",1)]),t("div",Mt,[t("div",{class:"h-full bg-amber-500 transition-all",style:N({width:`${s.value}%`})},null,4)]),t("p",Vt,"预计剩余 "+u(c.value)+" 秒",1)]),t("div",Tt,[x[3]||(x[3]=t("p",{class:"mb-2 text-sm font-medium"},"水果完成状态",-1)),t("div",jt,[(i(!0),p(C,null,h(l(n).draft.fruitCount,e=>(i(),p("div",{key:e,class:_(["rounded-xl border px-2 py-2 text-center",a.value.includes(e)?"border-emerald-300 bg-emerald-50 text-emerald-700":"border-stone-200 text-stone-500"])},u(a.value.includes(e)?"已完成":"处理中")+" #"+u(e),3))),128))])]),t("div",Nt,[t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:x[0]||(x[0]=e=>b("back"))},"上一步"),t("button",{class:_(["rounded-xl px-4 py-3 font-semibold text-white",d.value?"bg-amber-500":"bg-stone-300"]),disabled:!d.value,onClick:x[1]||(x[1]=e=>b("next"))},u(d.value?"继续：完成提示":"制作中..."),11,It)])]))}},Dt={class:"space-y-4"},Ft={class:"card p-4"},zt={class:"mt-1 text-sm text-stone-500"},At={class:"card p-4"},Pt={class:"whitespace-pre-wrap rounded-xl bg-stone-50 p-3 text-xs text-stone-600"},Rt={class:"grid grid-cols-1 gap-2"},Ut={key:0,class:"rounded-xl bg-green-50 px-3 py-2 text-xs text-green-600"},Ot={__name:"Step5Complete",emits:["restart"],setup(k,{emit:m}){const b=m,n=I(),s=w(),d=B(),a=g(!1),o=g(""),f=$(()=>s.draft.mode==="juice"?"果汁":s.draft.mode==="canned"?"罐头":s.draft.mode==="cut"?"果切":"-"),c=$(()=>s.draft.mode==="juice"?{texture:s.draft.settings.texture,temperature:s.draft.settings.temperature,sweetnessType:s.draft.settings.sweetnessType,sweetnessValue:s.draft.settings.sweetnessValue}:s.draft.mode==="canned"?{temperature:s.draft.settings.cannedTemperature,sweetnessValue:s.draft.settings.cannedSweetness}:{bladeChecked:!0});function v(){var e;(e=d.currentUser)!=null&&e.id&&(s.addHistoryRecord({userId:d.currentUser.id,mode:s.draft.mode,fruitCount:s.draft.fruitCount,preprocess:s.draft.fruits,params:c.value,image:o.value||""}),a.value=!0)}function y(){s.resetDraft(),o.value="",a.value=!1,b("restart")}function x(){s.resetDraft(),n.push("/my")}return(e,r)=>(i(),p("div",Dt,[t("div",Ft,[r[1]||(r[1]=t("h2",{class:"text-lg font-semibold text-emerald-700"},"步骤5：制作完成",-1)),t("p",zt,"本次模式："+u(f.value)+"，水果数量："+u(l(s).draft.fruitCount)+"。",1)]),t("div",At,[r[2]||(r[2]=t("p",{class:"mb-2 text-sm font-medium"},"参数回顾",-1)),t("pre",Pt,u(JSON.stringify(c.value,null,2)),1)]),D(P,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=S=>o.value=S),label:"制作截图（可选）","aspect-hint":"自由比例"},null,8,["modelValue"]),t("div",Rt,[t("button",{class:"rounded-xl bg-amber-500 px-4 py-3 font-semibold text-white",onClick:v},"保存到历史制作记录"),a.value?(i(),p("p",Ut,"已保存，可在“我的 -> 历史制作记录”查看。")):F("",!0),t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:y},"再做一单"),t("button",{class:"rounded-xl border border-stone-300 px-4 py-3",onClick:x},"完成并去我的")])]))}},Et={class:"space-y-4"},Lt={class:"card p-3"},qt={class:"grid grid-cols-5 gap-1 text-center text-[11px]"},Kt={__name:"ProductionWizard",setup(k){const m=g(1),b={1:H,2:Z,3:kt,4:Bt,5:Ot},n=["水果安放","预处理","方案选择","制作监控","完成"],s=$(()=>b[m.value]);function d(){m.value<5&&(m.value+=1)}function a(){m.value>1&&(m.value-=1)}function o(){m.value=1}return(f,c)=>(i(),p("div",Et,[t("div",Lt,[t("div",qt,[(i(),p(C,null,h(n,(v,y)=>t("div",{key:v,class:_(["rounded-xl px-1 py-2",y+1<=m.value?"bg-amber-500 text-white":"bg-stone-100 text-stone-500"])},u(y+1)+"."+u(v),3)),64))])]),(i(),z(A(s.value),{onNext:d,onBack:a,onRestart:o},null,32))]))}};export{Kt as default};
